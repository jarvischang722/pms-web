<?xml version="1.0" encoding="UTF-8"?>
<root>
    <!-- ['PMS0810090']-->
    <dao name="GET_GUEST_MN.GUEST_TYP_COUNT">
        <statement><![CDATA[
            select count(*) as guest_count
             from guest_mn
             where athena_id = ? and trim(guest_typ) = ? and rownum = 1
        ]]>
        </statement>
        <parameter type="int" kind="1">athena_id</parameter>
        <parameter type="string" kind="1">guest_typ</parameter>
    </dao>

    <!-- ['PMS0820040'] 檢查住客歷史有無用到-->
    <dao name="GET_GUEST_MN.AIRLINE_COD_COUNT">
        <statement><![CDATA[
            select count(*) as guest_count
             from guest_mn
             where athena_id = ? and trim(airline_cod) = :airline_cod and rownum = 1
        ]]>
        </statement>
        <parameter type="int" kind="1">athena_id</parameter>
        <parameter type="string" kind="3">airline_cod</parameter>
    </dao>

    <!-- ['PMS0820040'] 檢查住客歷史有無用到-->
    <dao name="GET_GUEST_MN.AIRLINE_COD_COUNT">
        <statement><![CDATA[
            select count(*) as guest_count
             from guest_mn
             where athena_id = ? and trim(airline_cod) = :airline_cod and rownum = 1
        ]]>
        </statement>
        <parameter type="int" kind="1">athena_id</parameter>
        <parameter type="string" kind="3">airline_cod</parameter>
    </dao>

    <!-- [PMS0610020 商務公司資料編輯] 合約內容
        合約指定的房價代號未有相關訂房卡指定則可刪除合約 -->
    <dao name="CHK_RATE_COD_IS_EXIST_IN_GUEST_MN">
        <statement><![CDATA[
            SELECT  COUNT(*) as order_rate_Count
            FROM  GUEST_MN
            WHERE  ATHENA_ID = :athena_id
            AND  ACUST_COD = :cust_cod
            AND  trim(HOTEL_COD) = trim(:hotel_cod)
            AND  trim(RATE_COD) = trim(:rate_cod)
            AND  ROWNUM <= 1
        ]]>
        </statement>
        <parameter type="number" kind="3">athena_id</parameter>
        <parameter type="string" kind="3">cust_cod</parameter>
        <parameter type="string" kind="3">hotel_cod</parameter>
        <parameter type="string" kind="3">rate_cod</parameter>
    </dao>

    <!-- PMS0210011 住客歷史資料編輯 取得『預約來館資料』-->
    <dao name="QRY_GUEST_MN">
        <statement><![CDATA[
            SELECT  DISTINCT ORDER_DT.ORDER_STA, ORDER_DT.CI_DAT, ORDER_DT.CO_DAT, ORDER_MN.ACUST_NAM, ORDER_MN.CUST_NAM, ORDER_MN.GALT_NAM,
            ORDER_MN.ATTEN_NAM, ORDER_DT.RATE_COD, ORDER_DT.USE_COD, ORDER_DT.ORDER_QNT, ORDER_DT.RENT_AMT, ( ORDER_DT.ADULT_QNT + ORDER_DT.CHILD_QNT + ORDER_DT.BABY_QNT ) GUEST_QNT,
            ORDER_DT.IKEY, ORDER_DT.IKEY_SEQ_NOS
            FROM  ORDER_DT, ORDER_MN, GUEST_MN
            WHERE  ORDER_MN.ATHENA_ID = ORDER_DT.ATHENA_ID
            AND  ORDER_MN.IKEY = ORDER_DT.IKEY
            AND  ORDER_DT.ATHENA_ID = GUEST_MN.ATHENA_ID
            AND  ORDER_DT.IKEY = GUEST_MN.IKEY
            AND  ORDER_DT.IKEY_SEQ_NOS = GUEST_MN.IKEY_SEQ_NOS
            AND  ORDER_DT.CI_DAT >= :rent_cal_dat
            AND  ORDER_DT.ORDER_STA <> 'D'
            AND  GUEST_MN.ATHENA_ID = :athena_id
            AND  GUEST_MN.GCUST_COD = :gcust_cod
            AND  trim(ORDER_MN.HOTEL_COD) = trim(:hotel_cod)
            ORDER BY  ORDER_DT.CI_DAT, ORDER_DT.IKEY, ORDER_DT.IKEY_SEQ_NOS
        ]]>
        </statement>
        <parameter type="number" kind="3">athena_id</parameter>
        <parameter type="string" kind="3">hotel_cod</parameter>
        <parameter type="string" kind="3">gcust_cod</parameter>
        <parameter type="date" kind="3">rent_cal_dat</parameter>
    </dao>
</root>