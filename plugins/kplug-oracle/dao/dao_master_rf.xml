<?xml version="1.0" encoding="UTF-8"?>
<root>
    <!-- ['PMS0830090'] 取得公帳號設定master_rf(多筆) -->
    <dao name="QRY_MASTER_RF">
        <statement><![CDATA[
            select m.athena_id, m.hotel_cod, m.master_nos, m.master_typ, m.master_sta, m.cust_cod, nvl2(c.show_cod, trim(c.show_cod) || ':' || trim(c.cust_nam),'') show_cod, nvl2(m.deposit_nos, trim(m.deposit_nos) || ':' || trim(d.alt_nam),'') deposit_nos, m.ins_dat, m.ins_usr, m.upd_dat, m.upd_usr
            from master_rf m
            left join cust_mn c on c.athena_id = m.athena_id and c.cust_cod = m.cust_cod
            left join deposit_mn d on d.athena_id = m.athena_id and d.deposit_nos = m.deposit_nos
            where m.athena_id = :athena_id and trim(m.hotel_cod) = trim(:hotel_cod)
        ]]>
        </statement>
        <statement test="_v(param.master_typ)"><![CDATA[and master_typ in(:master_typ)]]></statement>
        <statement test="_v(param.master_sta)"><![CDATA[and master_sta in(:master_sta)]]></statement>
        <parameter type="int" kind="3">athena_id</parameter>
        <parameter type="string" kind="3">hotel_cod</parameter>
        <parameter type="instring" kind="3">master_typ</parameter>
        <parameter type="instring" kind="3">master_sta</parameter>
        <!--<parameter type="likestring" kind="2" condition="product_nam like ?">product_nam</parameter>-->
    </dao>

    <!-- ['PMS0830090'] 取得公帳號設定master_rf(單筆) -->
    <dao name="QRY_SINGLE_MASTER_RF">
        <statement><![CDATA[
            select m.athena_id, m.hotel_cod, m.master_nos, m.master_typ, m.master_sta, m.cust_cod, c.show_cod, nvl2(c.show_cod, trim(c.show_cod) || ':' || trim(c.cust_nam),'') cust_nam, m.deposit_nos, nvl2(m.deposit_nos, trim(m.deposit_nos) || ':' || trim(d.alt_nam),'') deposit_nam, m.ins_dat, m.ins_usr, m.upd_dat, m.upd_usr
            from master_rf m
            left join cust_mn c on c.athena_id = m.athena_id and c.cust_cod = m.cust_cod
            left join deposit_mn d on d.athena_id = m.athena_id and d.deposit_nos = m.deposit_nos
            where trim(m.athena_id) = trim(:athena_id)  and trim(m.hotel_cod) = trim(:hotel_cod) and trim(m.master_nos) = trim(:master_nos)
        ]]>
        </statement>
        <parameter type="int" kind="3">athena_id</parameter>
        <parameter type="string" kind="3">hotel_cod</parameter>
        <parameter type="string" kind="3">master_nos</parameter>
    </dao>

    <!-- [PMS0110040訂房卡多筆] 公帳號選單 -->
    <dao name="SEL_MASTER_RF">
        <statement><![CDATA[
            select master_nos, cust_nam, master_sta
            from master_rf where  athena_id = :athena_id and hotel_cod = :hotel_cod order by master_nos
        ]]>
        </statement>
        <parameter type="number" kind="3">athena_id</parameter>
        <parameter type="string" kind="3">hotel_cod</parameter>
    </dao>
</root>