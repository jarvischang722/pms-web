<?xml version="1.0" encoding="UTF-8"?>
<root>
    <!-- 使用者有權限的公司 -->
    <dao name="QUY_ROLE_USER_USE_HOTELS">
        <statement><![CDATA[
			SELECT DISTINCT hotel_rf.hotel_nam ,hotel_rf.hotel_cod,brf.FUNC_ATHENA_ID as athena_id
			FROM  hotel_rf
			INNER JOIN  bac_role_function brf ON brf.func_hotel_cod = hotel_rf.hotel_cod
			join bac_role_user bru ON brf.role_athena_id = bru.role_athena_id and brf.role_id = bru.role_id
			WHERE trim(bru.USER_ATHENA_ID) = trim(:user_athena_id)
			AND trim(bru.user_id) = trim(:user_id)
        ]]>
        </statement>
        <parameter type="string" kind="3">user_athena_id</parameter>
        <parameter type="string" kind="3">user_id</parameter>
    </dao>

    <!-- (old)使用者有權限的公司 -->
    <dao name="OLD_QUY_ROLE_USER_USE_HOTELS">
        <statement><![CDATA[
              SELECT DISTINCT   hotel_rf.hotel_nam ,hotel_rf.hotel_cod
              FROM  hotel_rf
              INNER JOIN  bac_role_function  ON bac_role_function.fun_hotel_cod = hotel_rf.hotel_cod
              join bac_role_user on bac_role_function.role_comp_cod = bac_role_user.role_comp_cod and bac_role_function.role_id = bac_role_user.role_id
              WHERE trim(bac_role_user.user_comp_cod) = trim(:comp_id)
              AND trim(bac_role_user.user_id) = trim(:user_id)
        ]]>
        </statement>
        <parameter type="string" kind="3">comp_id</parameter>
        <parameter type="string" kind="3">user_id</parameter>
    </dao>


    <!-- 使用者可選的系統 -->
    <dao name="QUY_ROLE_USER_USE_SYSTEM">
        <statement><![CDATA[
            SELECT  DISTINCT   current_id as sys_id, sys.SYS_NAME as sys_name_zh_tw,  sys.SYS_ENAME as sys_name_en, sys.SORT_COD
            FROM BAC_ROLE_FUNCTION  brf
            JOIN bac_role_user bru ON brf.role_athena_id = bru.role_athena_id and brf.role_id = bru.role_id
            JOIN S99_SYSTEM  sys   on sys.SYS_ID = brf.current_id
            where trim(bru.user_comp_cod) = trim(:user_comp_cod)
            AND trim(bru.user_id) = trim(:user_id)
            AND trim(func_comp_cod) = trim(:fun_comp_cod)
            and trim(func_hotel_cod) = trim(:fun_hotel_cod)
            AND brf.ID_TYP = 'SYSTEM'
            order by sys.SORT_COD
        ]]>
        </statement>
        <parameter type="string" kind="3" >user_comp_cod</parameter>
        <parameter type="string" kind="3">user_id</parameter>
        <parameter type="string" kind="3">fun_comp_cod</parameter>
        <parameter type="string" kind="3">fun_hotel_cod</parameter>

    </dao>

    <!-- (old)使用者可選的系統 -->
    <dao name="OLD_QUY_ROLE_USER_USE_SYSTEM">
        <statement><![CDATA[
            SELECT  DISTINCT   current_id as sys_id, sys.SYS_NAME as sys_name_zh_tw,  sys.SYS_ENAME as sys_name_en, sys.SORT_COD
            FROM BAC_ROLE_FUNCTION  brf
            JOIN bac_role_user bru ON brf.role_comp_cod = bru.role_comp_cod AND brf.role_id = bru.role_id
            JOIN S99_SYSTEM  sys   on sys.SYS_ID = brf.current_id
            where trim(bru.user_comp_cod) = trim(:user_comp_cod)
            AND trim(bru.user_id) = trim(:user_id)
            AND trim(fun_comp_cod) = trim(:fun_comp_cod)
            and trim(fun_hotel_cod) = trim(:fun_hotel_cod)
            AND id_typ <> 'FUNCTION'
            AND brf.ID_TYP   = 'SYSTEM'
            order by sys.SORT_COD
        ]]>
        </statement>
        <parameter type="string" kind="3" >user_comp_cod</parameter>
        <parameter type="string" kind="3">user_id</parameter>
        <parameter type="string" kind="3">fun_comp_cod</parameter>
        <parameter type="string" kind="3">fun_hotel_cod</parameter>

    </dao>

    <!--使用者可使用作業menu-->
    <dao name="QRY_BAC_SYS_MODULE_BY_USER">
        <statement><![CDATA[

        select distinct bac_role_function.fun_comp_cod, s99_company.cmp_name, bac_role_function.fun_hotel_cod, hotel_rf.hotel_nam, bac_role_function.sys_id, s99_system.sys_name, bac_role_function.subsys_id, bac_subsysmenu.subsys_nam, bac_role_function.mdl_id, s99_model.mdl_name,
        bac_role_function.pro_id, s99_process.pro_name,s99_process.sort_cod from bac_role_function
        join s99_company on bac_role_function.fun_comp_cod = s99_company.cmp_id
        join hotel_rf on bac_role_function.fun_hotel_cod = hotel_rf.hotel_cod
        join bac_role_user on bac_role_function.role_comp_cod = bac_role_user.role_comp_cod and bac_role_function.role_id = bac_role_user.role_id
        join s99_system on bac_role_function.sys_id = s99_system.sys_id
        join bac_subsysmenu on bac_role_function.subsys_id = bac_subsysmenu.subsys_id
        join s99_model on bac_role_function.mdl_id = s99_model.mdl_id
        join s99_process on bac_role_function.pro_id = s99_process.pro_id
        WHERE trim(bac_role_user.user_comp_cod) = trim(:user_comp_cod)
        AND trim(bac_role_user.user_id) = trim(:user_id)
        and trim(bac_role_function.sys_id) = trim(:sys_id)
        AND trim(bac_role_function.fun_hotel_cod) = trim(:fun_hotel_cod)
        order by bac_role_function.fun_comp_cod,bac_role_function.fun_hotel_cod,bac_role_function.sys_id,bac_role_function.subsys_id,bac_role_function.mdl_id,s99_process.sort_cod,bac_role_function.pro_id
        ]]>
        </statement>
        <parameter type="string" kind="3" >user_comp_cod</parameter>
        <parameter type="string" kind="3">user_id</parameter>
        <parameter type="string" kind="3">sys_id</parameter>
        <parameter type="string" kind="3">fun_hotel_cod</parameter>
    </dao>

    <!--使用者可使用快選menu-->
    <dao name="QRY_USER_QUICK_MENU">
        <statement><![CDATA[

            select distinct bac_quickmenu.comp_cod, s99_company.cmp_name, bac_quickmenu.hotel_cod,
            hotel_rf.hotel_nam, bac_quickmenu.sys_id, s99_system.sys_name, bac_quickmenu.subsys_id, bac_subsysmenu.subsys_nam,
            bac_quickmenu.pro_id, s99_process.pro_name, bac_quickmenu.sort_cod from bac_quickmenu
            join s99_company on bac_quickmenu.comp_cod = s99_company.cmp_id
            join hotel_rf on bac_quickmenu.hotel_cod = hotel_rf.hotel_cod
            join s99_system on bac_quickmenu.sys_id = s99_system.sys_id
            join bac_subsysmenu on bac_quickmenu.subsys_id = bac_subsysmenu.subsys_id
            join s99_process on bac_quickmenu.pro_id = s99_process.pro_id
            join bac_role_function on bac_role_function.fun_comp_cod = bac_quickmenu.comp_cod and bac_role_function.fun_hotel_cod = bac_quickmenu.hotel_cod and bac_role_function.pro_id = bac_quickmenu.pro_id
            join bac_role_user on bac_role_function.role_comp_cod = bac_role_user.role_comp_cod and bac_role_function.role_id = bac_role_user.role_id
            where trim(bac_role_user.user_comp_cod) = trim(:user_comp_cod)
            and trim(bac_role_user.user_id) = trim(:user_id)
            and trim(bac_role_function.sys_id) = trim(:sys_id)
            and trim(bac_quickmenu.subsys_id) = trim(:subsys_id)
            and trim(bac_quickmenu.hotel_cod) = trim(:fun_hotel_cod)
            order by bac_quickmenu.comp_cod,bac_quickmenu.hotel_cod,bac_quickmenu.sys_id,bac_quickmenu.subsys_id,bac_quickmenu.sort_cod,bac_quickmenu.pro_id
        ]]>
        </statement>

        <parameter type="string" kind="3">user_comp_cod</parameter>
        <parameter type="string" kind="3">user_id</parameter>
        <parameter type="string" kind="3">sys_id</parameter>
        <parameter type="string" kind="3">subsys_id</parameter>
        <parameter type="string" kind="3">fun_hotel_cod</parameter>

    </dao>

    <!--使用者可使用公司別、館別-->
    <dao name="test_hotel">
        <statement><![CDATA[
            select bac_role_func_scope.scope_comp_cod, s99_company.cmp_name, bac_role_func_scope.scope_hotel_cod, hotel_rf.hotel_nam
            from bac_role_func_scope
            join bac_role_user on bac_role_func_scope.role_comp_cod = bac_role_user.role_comp_cod and bac_role_func_scope.role_id = bac_role_user.role_id
            join s99_company on bac_role_func_scope.scope_comp_cod = s99_company.cmp_id
            join hotel_rf on bac_role_func_scope.scope_hotel_cod = hotel_rf.hotel_cod
        ]]>
        </statement>
    </dao>




</root>