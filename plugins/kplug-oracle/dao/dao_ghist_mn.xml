<?xml version="1.0" encoding="UTF-8"?>
<root>
    <!-- ['PMS0810090']-->
    <dao name="GET_GHIST_MN.GUEST_TYP_COUNT">
        <statement><![CDATA[
            select count(*) as guest_count
             from ghist_mn
             where athena_id = ?  and trim(guest_typ) = ? and rownum = 1

        ]]>
        </statement>
        <parameter type="int" kind="1">athena_id</parameter>
        <parameter type="string" kind="1">guest_typ</parameter>
    </dao>

    <!-- ['PMS0810060'] 檢查住客歷史有無用到-->
    <dao name="GET_GHIST_MN.LIVE_COD_COUNT">
        <statement><![CDATA[
         select count(*) as ghistcount
         from ghist_mn
         where athena_id =? and live_cod = ? and rownum = 1

        ]]>
        </statement>
        <parameter type="int" kind="1">athena_id</parameter>
        <parameter type="string" kind="1">live_cod</parameter>
    </dao>

    <!-- ['PMS0820040'] 檢查住客歷史有無用到-->
    <dao name="GET_GHIST_MN.AIRLINE_COD_COUNT">
        <statement><![CDATA[
         select count(*) as ghistcount
         from ghist_mn
         where athena_id =? and trim(airline_cod) = :airline_cod and rownum = 1

        ]]>
        </statement>
        <parameter type="int" kind="1">athena_id</parameter>
        <parameter type="string" kind="3">airline_cod</parameter>
    </dao>

    <dao name="QRY_GHIST_MN">
        <statement><![CDATA[
        SELECT GHIST_MN.ATHENA_ID, CUST_IDX.SHOW_COD, GHIST_MN.STATUS_COD, CUST_IDX.ALT_NAM, CUST_IDX.SEX_TYP, CUST_IDX.ID_COD,
        CNTRY_RF.CONTRY_NAM, GHIST_VISIT_DT.VISIT_NOS, GHIST_VISIT_DT.VISIT_DAYS, GHIST_VISIT_DT.TRANS_TOT, CUST_IDX.MOBILE_NOS,CUST_IDX.E_MAIL
        FROM  GHIST_VISIT_DT, CUST_IDX, CUST_IDX AGENT_IDX, GHIST_MN, CNTRY_RF
        WHERE  GHIST_MN.ATHENA_ID = CUST_IDX.ATHENA_ID
        AND  GHIST_MN.GCUST_COD = CUST_IDX.CUST_COD
        AND  GHIST_MN.ATHENA_ID = CNTRY_RF.ATHENA_ID
        AND  GHIST_MN.CONTRY_COD = CNTRY_RF.CONTRY_COD
        AND  GHIST_MN.ATHENA_ID = AGENT_IDX.ATHENA_ID(+)
        AND  GHIST_MN.ACUST_COD = AGENT_IDX.CUST_COD(+)
        AND  GHIST_MN.ATHENA_ID = GHIST_VISIT_DT.ATHENA_ID(+)
        AND  GHIST_MN.GCUST_COD = GHIST_VISIT_DT.GCUST_COD(+)
        AND  GHIST_VISIT_DT.HOTEL_COD(+) = :hotel_cod
        AND  GHIST_MN.ATHENA_ID = :athena_id

        ]]>
        </statement>
        <parameter type="number" kind="3">athena_id</parameter>
        <parameter type="string" kind="3">hotel_cod</parameter>
    </dao>
</root>