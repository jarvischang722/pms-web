<?xml version="1.0" encoding="UTF-8"?>
<root>
    <!--  -->
    <dao name="QRY_RVRMCOD_RF">
        <statement><![CDATA[
            select * from rvrmcod_rf
            where athena_id = :athena_id and trim(hotel_cod) = trim(:hotel_cod)
        ]]>
        </statement>
        <parameter type="string" kind="3">athena_id</parameter>
        <parameter type="string" kind="3">hotel_cod</parameter>
    </dao>

    <!-- 單筆房型資料 -->
    <dao name="QRY_SINGLE_RVRMCOD_RF">
        <statement><![CDATA[
			select *
			from rvrmcod_rf rvrm
			where rvrm.athena_id = :athena_id and rvrm.begin_dat = to_date(:begin_dat, 'YYYY/MM/DD')
			     and trim(rvrm.room_cod) = trim(:room_cod) and trim(rvrm.hotel_cod) = trim(:hotel_cod)
        ]]>
        </statement>
        <parameter type="string" kind="3">athena_id</parameter>
        <parameter type="string" kind="3">hotel_cod</parameter>
        <parameter type="string" kind="3">room_cod</parameter>
        <parameter type="string" kind="3">begin_dat</parameter>
    </dao>

    <!-- 查詢滾房租日 -->
    <dao name="CHK_EDIT_RVEMCOD_RF_DAT">
        <statement><![CDATA[
                SELECT val_nam as  belong_dat
                FROM COMP_SVAL_MN
                WHERE TRIM(VAL_RMK) = 'rent_cal_dat'
                     AND SYS_COD = 'HFD'
                     AND athena_id = :athena_id
        ]]>
        </statement>
        <parameter type="string" kind="3">athena_id</parameter>
    </dao>

    <!-- 取得房型資料 -->
    <dao name="QRY_RVRMCOD_RF_OLD_ROOM_COD">
        <statement><![CDATA[
               select room_nam,room_sna,room_typ
               from rvrmcod_rf
               where athena_id = :athena_id
               and trim(hotel_cod) = trim(:hotel_cod)
               and trim(room_cod)  = trim(:room_cod)
               and rownum = 1

        ]]>
        </statement>
        <parameter type="string" kind="3">athena_id</parameter>
        <parameter type="string" kind="3">hotel_cod</parameter>
        <parameter type="string" kind="3">room_cod</parameter>
    </dao>

    <!--  -->
    <dao name="CHK_RVRMCOD_RF_ROOM_DATA">
        <statement><![CDATA[
              select count(*) as room_count
              from rvrmcod_rf
              where athena_id = :athena_id
              and trim(hotel_cod) = trim(:hotel_cod)
              and room_cod =  :room_cod
        ]]>
        </statement>
        <parameter type="string" kind="3">athena_id</parameter>
        <parameter type="string" kind="3">hotel_cod</parameter>
        <parameter type="string" kind="3">room_cod</parameter>
        <parameter type="string" kind="2" condition="begin_dat <> to_date(:begin_dat, 'YYYY/MM/DD')">begin_dat</parameter>
        <parameter type="string" kind="3">begin_dat</parameter>
    </dao>

    <!--  -->
    <dao name="CHK_RVRMCOD_RF_IS_EXIST_RMINV_DT">
        <statement><![CDATA[
             select  count(*) as room_count
             from rminv_dt
             where   athena_id = :athena_id
             and trim(hotel_cod) = trim(:hotel_cod)
             and trim(room_cod) = trim(:room_cod)
             and rownum = 1
        ]]>
        </statement>
        <parameter type="string" kind="3">athena_id</parameter>
        <parameter type="string" kind="3">hotel_cod</parameter>
        <parameter type="string" kind="3">room_cod</parameter>
    </dao>

    <!-- 檢查要儲存房型的起始結束日有無重疊-->
    <dao name="CHK_RVRMCOD_RF_IS_COVER_BEGIN_END_DAT">
        <statement><![CDATA[

        SELECT count(*) AS cover_count
        FROM  rvrmcod_rf
        WHERE room_cod = :room_cod AND
        (
        BEGIN_DAT BETWEEN to_date(:begin_dat,'YYYY/MM/DD') AND to_date(:end_dat,'YYYY/MM/DD')
        OR
        END_DAT BETWEEN to_date(:begin_dat,'YYYY/MM/DD') AND to_date(:end_dat,'YYYY/MM/DD')
        )

        ]]>
        </statement>
        <parameter type="string" kind="3">room_cod</parameter>
        <parameter type="string" kind="3">begin_dat</parameter>
        <parameter type="string" kind="3">end_dat</parameter>
    </dao>

    <!-- 檢查要儲存房型的起始結束日有無重疊-->
    <dao name="CHK_RVRMCOD_RF_IS_EXIST">
        <statement><![CDATA[

        SELECT count(*) AS cover_count
        FROM  rvrmcod_rf
        WHERE room_cod = :room_cod AND
        (
        BEGIN_DAT BETWEEN to_date(:begin_dat,'YYYY/MM/DD') AND to_date(:end_dat,'YYYY/MM/DD')
        OR
        END_DAT BETWEEN to_date(:begin_dat,'YYYY/MM/DD') AND to_date(:end_dat,'YYYY/MM/DD')
        )

        ]]>
        </statement>
        <parameter type="string" kind="3">room_cod</parameter>
        <parameter type="string" kind="3">begin_dat</parameter>
        <parameter type="string" kind="3">end_dat</parameter>
    </dao>


    <!-- 房間小類設定存在時，不可刪除 [prg_id : PMS0810010] -->
    <dao name="CHK_GUEST_GRP_RF_IS_EXIST_RVRMCOD_RF">
        <statement><![CDATA[

        select count(*) as room_count
        from rvrmcod_rf
        where trim(athena_id) = trim(:athena_id)
        and trim(hotel_cod) = trim(:hotel_cod)
        and trim(room_typ) = trim(:room_typ)

        ]]>
        </statement>
        <parameter type="string" kind="3">athena_id</parameter>
        <parameter type="string" kind="3">hotel_cod</parameter>
        <parameter type="string" kind="3">room_typ</parameter>
    </dao>

    <!-- ['PMS0830100'] 取得房型 -->
    <dao name="QRY_HFD_REST_MN_ROOM_COD">
        <statement><![CDATA[
           select distinct room_cod as value, room_sna as display from rvrmcod_rf where athena_id = :athena_id and trim(hotel_cod) = trim(:hotel_cod) and end_dat >= :rent_cal_dat
        ]]>
        </statement>
        <parameter type="int" kind="3">athena_id</parameter>
        <parameter type="string" kind="3">hotel_cod</parameter>
        <parameter type="date" kind="3">rent_cal_dat</parameter>
    </dao>

    <dao name="CHK_RVRMCOD_RF_ROOM_TYP">
        <statement><![CDATA[
            select room_typ
            from rvrmcod_rf
            where athena_id = :athena_id
            and trim(hotel_cod) = trim(:hotel_cod)
            and trim(room_cod) = trim(:room_cod)
            and begin_dat <> to_date(:begin_dat, 'YYYY/MM/DD')
        ]]>
        </statement>
        <parameter type="int" kind="3">athena_id</parameter>
        <parameter type="string" kind="3">hotel_cod</parameter>
        <parameter type="string" kind="3">room_cod</parameter>
        <parameter type="string" kind="3">begin_dat</parameter>
    </dao>
</root>